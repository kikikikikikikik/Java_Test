import java.sql.*;
import java.util.Calendar;

public class LibMange {
    //连接数据库
    public static Connection getConnection(){
        String driver="com.mysql.jdbc.Driver";
        String url="jdbc:mysql://localhost:3306/library";//library是数据库名
        String user="root";//用户为自己
        String password="1002";//数据库密码
        Connection connection=null;
        try{
            Class.forName(driver);
            connection=DriverManager.getConnection(url,user,password);
        }
        catch(Exception e){
            e.printStackTrace();
        }
        return connection;
    }
    //增加
    public static int add(Book book)throws Exception{
        int row=0;
        String sql="insert into library(name,bno,author,publish,type,storeplace,storearea,state,date )values(?,?,?,?,?,?,?,?,?)";//？是占位符
        Connection connection=null;
        PreparedStatement ps=null;
        try{
            connection=getConnection();
            ps=connection.prepareStatement(sql);
            ps.setString(1, book.getName());//将指定参数设置为String值
            ps.setString(2, book.getBno());
            ps.setString(3, book.getAuthor());
            ps.setString(4, book.getPublish());
            ps.setString(5, book.getType());
            ps.setString(6, book.getStoreplace());
            ps.setString(7, book.getStorearea());
            ps.setBoolean(8, book.getState());
            Calendar calendar=Calendar.getInstance();//获得当前日历时间
            calendar.add(Calendar.DATE,360);//将当前日历时间增加一年
            ps.setDate(9, (Date) calendar.getTime());
            row=ps.executeUpdate();//执行sql语句
        }catch(Exception e){
            e.printStackTrace();
        }finally{
            ps.close();
            connection.close();
        }
        return row;
    }
    //更新
    public static int update(Book book)throws Exception{
        int row=0;
        String sql="update library set name=?,author=?,publish=?,type=?,storeplace=?,storearea=?,state=?";
        Connection connection=null;
        PreparedStatement ps=null;
        try{
            connection=getConnection();
            ps=connection.prepareStatement(sql);
            ps.setString(1, book.getName());
            ps.setString(2, book.getAuthor());
            ps.setString(3, book.getPublish());
            ps.setString(4, book.getType());
            ps.setString(5, book.getStoreplace());
            ps.setString(6, book.getStorearea());
            ps.setBoolean(7, book.getState());
            row=ps.executeUpdate();
        }catch(Exception e){
            e.printStackTrace();
        }finally{
            ps.close();
            connection.close();
        }
        return row;
    }
    //通过姓名选择
    public static Book selectByName(String name) throws SQLException {
        String sql="select *from library where name=?";
        ResultSet rs=null;//查询结果集
        Connection connection=null;
        PreparedStatement ps=null;
        Book t=null;
        connection=getConnection();
        try{
            ps=connection.prepareStatement(sql);//创建一个PrepareStatement类型的对象，将参数化的sql化的语句发送到数据库
            ps.setString(1,name);
            rs=ps.executeQuery();
            while(rs.next()){
                t=new Book();
                t.setName(rs.getString(1));
                t.setBno(rs.getString(2));
                t.setAuthor(rs.getString(3));
                t.setPublish(rs.getString(4));
                t.setType(rs.getString(5));
                t.setStoreplace(rs.getString(6));
                t.setStorearea(rs.getString(7));
                t.setState(rs.getBoolean(8));
            }
        } catch (SQLException e) {
            e.printStackTrace();
        }finally {
            rs.close();
            ps.close();
            connection.close();
        }
        return t;
    }
    public static Book selectById(String bno) throws SQLException {
        String sql="select *from library where bno=?";
        ResultSet rs=null;
        Connection connection=null;
        PreparedStatement ps=null;
        Book t=null;
        connection=getConnection();
        try {
            ps=connection.prepareStatement(sql);
            ps.setString(1,bno);
            rs=ps.executeQuery();
            while(rs.next()){
                t=new Book();
                t.setName(rs.getString(1));
                t.setBno(rs.getString(2));
                t.setAuthor(rs.getString(3));
                t.setPublish(rs.getString(4));
                t.setType(rs.getString(5));
                t.setStoreplace(rs.getString(6));
                t.setStorearea(rs.getString(7));
                t.setState(rs.getBoolean(8));
            }
        } catch (SQLException e) {
            e.printStackTrace();
        }finally{
            rs.close();
            ps.close();
            connection.close();
        }
        return t;
    }
    public static int delete(Date date) throws SQLException {
        java.sql.Date date1= (java.sql.Date) date;
        String sql="delete from library where date>?";
        Connection connection=null;
        int row1=0;
        PreparedStatement ps=null;
        try{
            connection=getConnection();
            ps=connection.prepareStatement(sql);
            ps.setDate(1,date1);
            row1=ps.executeUpdate();
        }catch (Exception e){
            e.printStackTrace();
        }finally {
            ps.close();
            connection.close();
        }
        return row1;
    }
}
